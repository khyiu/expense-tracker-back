Resources:
  AWSEBAutoScalingGroup:
    Metadata:
      AWS::CloudFormation::Authentication:
        S3Auth:
          type: "s3"
          buckets: ["grocery-tracker-certificate-private-key"]
          roleName:
            "Fn::GetOptionSetting":
              Namespace: "aws:autoscaling:launchconfiguration"
              OptionName: "IamInstanceProfile"
              DefaultValue: "aws-elasticbeanstalk-ec2-role"

files:
  /etc/pki/tls/certs/server.crt:
    content: |
      -----BEGIN CERTIFICATE-----
      MIIGwTCCBKmgAwIBAgIRANfbRX+sbg9yzTfVz1fGegEwDQYJKoZIhvcNAQEMBQAw
      SzELMAkGA1UEBhMCQVQxEDAOBgNVBAoTB1plcm9TU0wxKjAoBgNVBAMTIVplcm9T
      U0wgUlNBIERvbWFpbiBTZWN1cmUgU2l0ZSBDQTAeFw0yMDEwMjAwMDAwMDBaFw0y
      MTAxMTgyMzU5NTlaMEMxQTA/BgNVBAMTOGdyb2NlcnktdHJhY2tlci1iYWNrLTgu
      ZXUtY2VudHJhbC0xLmVsYXN0aWNiZWFuc3RhbGsuY29tMIIBIjANBgkqhkiG9w0B
      AQEFAAOCAQ8AMIIBCgKCAQEAvO2C+52dfkXDhhs6f3P75ZkK99WMZGTJ03kL+bse
      PfcIkTq28OCAV9CCa1UD7R3mj2b7UIx+pTJluOygD4g2YHPLLiHA1ctjjrdI0rdW
      Kr3sLdD+DZiu8miPVVCo7sMTENnrOLClGCTGwNyq4r0kYgd2m0rUhXb25Smk4zKw
      wzatrmdxAnQQ57Mi7geNOZ5PUiLEZbp366BYD6iM0LJL96PpaxoQ3X9TwCQsSwMu
      apNiOezltt2uWqrQ0EJPSsQp8LXQkN5MW35F5E7kK5XzMZWpoe829LrX8mHgQYcR
      94wu8rfiSvIDNSl0hnU/N+vZIp9b2tOXWQJHQhQests8owIDAQABo4ICpjCCAqIw
      HwYDVR0jBBgwFoAUyNl4aKLZGWjVPXLeXwo+3LWGhqYwHQYDVR0OBBYEFGVcXfm0
      JeFHUIHwD23AE3BtXEc2MA4GA1UdDwEB/wQEAwIFoDAMBgNVHRMBAf8EAjAAMB0G
      A1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjBJBgNVHSAEQjBAMDQGCysGAQQB
      sjEBAgJOMCUwIwYIKwYBBQUHAgEWF2h0dHBzOi8vc2VjdGlnby5jb20vQ1BTMAgG
      BmeBDAECATCBiAYIKwYBBQUHAQEEfDB6MEsGCCsGAQUFBzAChj9odHRwOi8vemVy
      b3NzbC5jcnQuc2VjdGlnby5jb20vWmVyb1NTTFJTQURvbWFpblNlY3VyZVNpdGVD
      QS5jcnQwKwYIKwYBBQUHMAGGH2h0dHA6Ly96ZXJvc3NsLm9jc3Auc2VjdGlnby5j
      b20wggEGBgorBgEEAdZ5AgQCBIH3BIH0APIAdwB9PvL4j/+IVWgkwsDKnlKJeSvF
      DngJfy5ql2iZfiLw1wAAAXVGqqVmAAAEAwBIMEYCIQCGa6KlIzlMlXNjRZJKz2RM
      ulOd/KVZ2pkpPgkqkdSAxQIhAIRNJIDJsgX920u0WbKLky2DmUySuHkA2DmC4i2O
      tX81AHcAlCC8Ho7VjWyIcx+CiyIsDdHaTV5sT5Q9YdtOL1hNosIAAAF1RqqluwAA
      BAMASDBGAiEAlVAa6ta+aa57X9BDFI9Boghr9xkqjEGShZnvG9Vv3kUCIQCwgAf6
      CAHeqBnA66fJWySR0B1ty3CAUULEjqkgnAZP5zBDBgNVHREEPDA6gjhncm9jZXJ5
      LXRyYWNrZXItYmFjay04LmV1LWNlbnRyYWwtMS5lbGFzdGljYmVhbnN0YWxrLmNv
      bTANBgkqhkiG9w0BAQwFAAOCAgEADWmXFCukLyxz/eot24cgXRWjIr0dHO0UCP4w
      roo4HsUkzbSm/Sce8Vpf3uTZ/GSLMNmP+FdGYZIagxJiKT927mW9uTNK3W/zDSFW
      U2xsqjjeqkzXaUe8Ex99YH1JsuOr1vsI2aLwfld6esNAKgMHt01Fw1syoUl9O6zx
      3xVOWy4aJLV4XhJCTp4ujVHrw2EivtblNl+2IatjtVS79r4hpAvdMw7sOfxNf+Yj
      7dQoTnZQKNlqYzR0f+2zRuMcEjA2n7SFbID9zgusar0gee3HXAA99vaXzl13PjYt
      ddTMEyPDl7TRXeVWOkcQ0vxUMMEFwRbndq3TGkto0SHsIIopm2leQ/pygSH+epXQ
      EqIkRmROpBJjwlHFnwvsnYWOz0u37BBYSYzwu1u9scMWxHqGgXBnfozt0fiMkDg7
      SR8xMw4sbHYdIm1PO2guVvoEpwP9wau04xX1b4jg2FCWr57qnszSh3jPzhjuAuHs
      DFsKHj9MXdGI1i1JaOYyc+H4keEXjIyOIpBkz2fGWfCV77Irc8gAmHvsPodW25hq
      QYj3Xzp3ONP00K1edwvX+C5YEWoBNNfr4L5CUS7kHMPFTyHbs5Dp8NNkee8aN5cE
      F3TE8mZdUwuxUye5pa1QO9YYtMe3Hdw6VFg4FRJ2fMmE+gDFVU2pxwk/yoiKVTAd
      T+10uyg=
      -----END CERTIFICATE-----

  # Private key
  "/etc/pki/tls/certs/server.key":
    mode: "000400"
    owner: root
    group: root
    authentication: "S3Auth"
    source: https://grocery-tracker-certificate-private-key.s3.eu-central-1.amazonaws.com/private.key

container_commands:
  01restart_nginx:
    command: "service nginx restart"