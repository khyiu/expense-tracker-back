Resources:
  AWSEBAutoScalingGroup:
    Metadata:
      AWS::CloudFormation::Authentication:
        S3Auth:
          type: "s3"
          buckets: ["grocery-tracker-certificate-private-key"]
          roleName:
            "Fn::GetOptionSetting":
              Namespace: "aws:autoscaling:launchconfiguration"
              OptionName: "IamInstanceProfile"
              DefaultValue: "aws-elasticbeanstalk-ec2-role"

files:
  /etc/pki/tls/certs/server.crt:
    content: |
      -----BEGIN CERTIFICATE-----
      MIIGvzCCBKegAwIBAgIQeLpqD61jvPUQ8xbq9goY5jANBgkqhkiG9w0BAQwFADBL
      MQswCQYDVQQGEwJBVDEQMA4GA1UEChMHWmVyb1NTTDEqMCgGA1UEAxMhWmVyb1NT
      TCBSU0EgRG9tYWluIFNlY3VyZSBTaXRlIENBMB4XDTIwMDcyMjAwMDAwMFoXDTIw
      MTAyMDIzNTk1OVowQzFBMD8GA1UEAxM4Z3JvY2VyeS10cmFja2VyLWJhY2stOC5l
      dS1jZW50cmFsLTEuZWxhc3RpY2JlYW5zdGFsay5jb20wggEiMA0GCSqGSIb3DQEB
      AQUAA4IBDwAwggEKAoIBAQC8vLvuwStD3roHoqsEk9HarswwkmaHVuwwzlZiZzuN
      E2jtAOp+jwO1iEuSbZ4Yruc+ZBivVZ9ptMe6OXHeCvFfiPeoZyAtYTl0354LNqb0
      7iSbL0hP27HRdQwsQgiDU3Y1DpqBbFFH5oIcvSD83bPDxHIMlS8SHAMDmTOY006s
      c6RyuNm87hueO13Ocx80A6STG1HetvVZCSW6vrdMHXRgVEiMTlhwOqd5mkQAz1Qy
      g43izWIDLGFBaymjCEeuFhQFxO25ZM2E6K9bg1sgqIMEzrlP+Jw8DVzrK28Eq9yg
      i7cOBG7ZX9rDH89aMi9EsrGqY00erxsJ90Orzt/CSkZ3AgMBAAGjggKlMIICoTAf
      BgNVHSMEGDAWgBTI2XhootkZaNU9ct5fCj7ctYaGpjAdBgNVHQ4EFgQUGWQtlZ9Y
      7HMPlPVGN3aR/YQHS7gwDgYDVR0PAQH/BAQDAgWgMAwGA1UdEwEB/wQCMAAwHQYD
      VR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMEkGA1UdIARCMEAwNAYLKwYBBAGy
      MQECAk4wJTAjBggrBgEFBQcCARYXaHR0cHM6Ly9zZWN0aWdvLmNvbS9DUFMwCAYG
      Z4EMAQIBMIGIBggrBgEFBQcBAQR8MHowSwYIKwYBBQUHMAKGP2h0dHA6Ly96ZXJv
      c3NsLmNydC5zZWN0aWdvLmNvbS9aZXJvU1NMUlNBRG9tYWluU2VjdXJlU2l0ZUNB
      LmNydDArBggrBgEFBQcwAYYfaHR0cDovL3plcm9zc2wub2NzcC5zZWN0aWdvLmNv
      bTCCAQUGCisGAQQB1nkCBAIEgfYEgfMA8QB2AAe3XBvlfWj/8bDGHSMVx7rmV3xX
      lLdq7rxhOhpp06IcAAABc3afykMAAAQDAEcwRQIhAKcNpFCJc74tupN2gU0GzMF5
      3/Slg0lu9ItiTaa5JAcRAiBr6IX6lA/PL8APCVMEokoV74oypvgPt1X5LuhaKFvW
      mAB3AOcS8rA3fhpi+47JDGGE8ep7N8tWHREmW/Pg80vyQVRuAAABc3afymkAAAQD
      AEgwRgIhAMyp6CJM6uoNCuAFksSJ85eqeRmpGfCnyvx17r2d9OmmAiEAwwAZBHSx
      a0O6G9xUbeOe92QwsZc/XKytfU3E1CY6S+swQwYDVR0RBDwwOoI4Z3JvY2VyeS10
      cmFja2VyLWJhY2stOC5ldS1jZW50cmFsLTEuZWxhc3RpY2JlYW5zdGFsay5jb20w
      DQYJKoZIhvcNAQEMBQADggIBAFbQsDGYUsW5PcZsvBCXGORhSsX3JddYekuBpWqr
      Lkt6KC4CmxJ8Hh+7eOpCleol/eXCP8/LOZ9xnzKnP9tr2y2qcbnOcnJDmDB7HKEr
      2gUttpYCG3VZ6AxZfKLc+aqWQYk3sSL/t3YPp86/+/Ek2951n9ipCY9r6zhZOrVb
      x7b9SoUbtXWW6zsA6oUWawZ5tzikFADXi5FNEiQaVF44QX0zPdlWujIWyEqDTbcV
      /4zhJjJvLAKnlXLfLQQJATwdC+eUZwpmBZQpvroqtTee4rNIod4T3MmmGoFXNven
      H4DCKcuIPiBLYerD4yHns4faRMzkP9zKW0cxud6xQeyg6kkBUxjHOjhOaN9m5zTG
      GpqMx1Ll7na3qexytfFcwokbH+u86Sy0rIIymsVsymmWqo75HJS5ozRRNdMFUx6E
      ftVqKwt2vKKBLbbhanlrDdQXWvXuWiX4wvb21GyI73wNBRnmZ1VExUHwPAS0dVKW
      aR1j0yrm1s4Ink6pHEQPzNCOQ0NTidsYR+OCjM0czAKpGesPis9wuxWAaYjs1PGD
      p5OH9Z1lhq2YlHV7McPFLNyTiWM41lsKC6Yp7pMUW0awBhHbpN/FD5AvM5oWgtf+
      6M1uAbfaedtUOvoDLh3yuFAy41DfdJOB8x1gJoO5rgQTKOkSw6DPBo9RRgZJS9+C
      1vcN
      -----END CERTIFICATE-----

  # Private key
  "/etc/pki/tls/certs/server.key":
    mode: "000400"
    owner: root
    group: root
    authentication: "S3Auth"
    source: https://grocery-tracker-certificate-private-key.s3.eu-central-1.amazonaws.com/private.key

container_commands:
  01restart_nginx:
    command: "service nginx restart"